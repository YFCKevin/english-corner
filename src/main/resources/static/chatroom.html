<!DOCTYPE html>
<html lang="en" xmlns:x-bind="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <meta property="og:title" content="TalkYo">
    <meta property="og:description" content="TalkYo - 英文口說智慧學習，讓你更有自信開口說英文！">
    <meta property="og:type" content="website">
    <meta property="og:image" content="img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="img/favicon.png">
    <link rel="icon" type="image/png" href="img/favicon.png">
    <title>
        TalkYo
    </title>
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/style.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
    <script src="js/deviceType.js"></script>
</head>
<body x-data="loadData()" x-init="init()" @click.outside="clickOutsideEditIcon">
<div class="container-fluid h-100">
    <div class="row h-100 d-flex justify-content-center align-items-center">
        <div   :class="{
                    'closed-margin-top': closed && !(browserType === 'Chrome' || browserType === 'Safari'),
                    'closed-margin-top-chrome': closed && browserType === 'Chrome',
                    'closed-margin-top-safaris': closed && browserType === 'Safari'
                  }"  class="col-md-8 col-lg-9 chat-area p-0">

            <div class="chat-header">
                <div class="d-flex align-items-center justify-content-between p-2">
                    <a
                            href="index.html"
                            class="text-dark ps-3"
                            style="border: 0"
                            data-bs-dismiss="modal">
                    <span aria-hidden="true">
                      <i class="fas fa-chevron-left"></i>
                    </span>
                    </a>
                    <template x-if="globalLink">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-friends me-2 text-success"></i>
                            <span>分享的聊天記錄</span>
                        </div>
                    </template>
                    <template x-if="['PROJECT', 'SITUATION'].includes(chatroomType)">
                        <div class="d-flex align-items-center">
                            <template x-if="messages && messages.length < 10">
                                <img x-bind:src="partner.coverPath" class="avatar small" alt="partner img">
                            </template>
                            <template x-if="closed">
                                <span>聊天記錄</span>
                            </template>
                            <template x-if="globalLink">
                                <span>分享的聊天記錄</span>
                            </template>
                            <template x-if="messages && messages.length >= 10">
                                <button x-show="!closed" @click.stop="endLesson" class="end-lesson-button btn rounded-pill text-white btn-sm" style="background-color: #20c997;">End this lesson</button>
                            </template>
                        </div>
                    </template>
                    <template x-if="['FREE_TALK'].includes(chatroomType)">
                        <div class="d-flex align-items-center">
                            <img x-bind:src="partner.coverPath" class="avatar small" alt="partner img">
                        </div>
                    </template>
                    <div class="dropdown">
                        <button class="btn btn-link text-dark ps-3" id="dropdownMenuBtn" data-bs-toggle="dropdown">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end main">
                            <template x-if="chatroomType == 'FREE_TALK'">
                                <li class="list-group-item border-0 px-0" @click.stop="startNewTalk">
                                    <div class="form-check form-switch ps-0 d-flex align-items-center">
                                        <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small">
                                            <i class="fas fa-comments-dollar me-2"></i>
                                            開始新對話
                                        </label>
                                    </div>
                                </li>
                                <li class="list-group-item border-0 px-0" @click.stop="openTalkRecord">
                                    <div class="form-check form-switch ps-0 d-flex align-items-center ">
                                        <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small">
                                            <i  class="fas fa-redo-alt me-2"></i>
                                            歷史紀錄
                                        </label>
                                    </div>
                                </li>
                            </template>
                            <li class="list-group-item border-0 px-0">
                                <div class="form-check form-switch ps-0 d-flex align-items-center justify-content-between">
                                    <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small" for="hideTextLabel">隱藏文字 (練習聽力)</label>
                                    <input class="form-check-input ms-auto mx-3 dropdown-checkbox" type="checkbox" id="hideTextLabel" x-model="blurText" @change="saveAndChangeDropdownSettings">
                                </div>
                            </li>
                            <li class="list-group-item border-0 px-0">
                                <div class="form-check form-switch ps-0 d-flex align-items-center justify-content-between">
                                    <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small" for="showTranslation">顯示翻譯</label>
                                    <input class="form-check-input ms-auto mx-3 dropdown-checkbox" type="checkbox" id="showTranslation" x-model="showTranslation" @change="saveAndChangeDropdownSettings">
                                </div>
                            </li>
                            <li class="list-group-item border-0 px-0">
                                <div class="form-check form-switch ps-0 d-flex align-items-center justify-content-between">
                                    <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small" for="showTipBtn">顯示提示</label>
                                    <input class="form-check-input ms-auto mx-3 dropdown-checkbox" type="checkbox" id="showTipBtn" x-model="showTipBtn" @change="saveAndChangeDropdownSettings">
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <template x-if="messages.length > 0 && (chatroomType == 'PROJECT' || chatroomType == 'SITUATION')">
                    <div x-show="!closed" class="progress progress-md px-3" style="height: 5px; background-color: white;">
                        <div class="progress-bar"
                             role="progressbar"
                             :aria-valuenow="messages.length * 10"
                             :style="'width: ' + messages.length * 10 + '%; background-color: var(--bs-teal); border-radius: 1rem;'"
                             aria-valuemin="0"
                             aria-valuemax="100">
                        </div>
                    </div>
                </template>
            </div>

            <div class="message-body mb-2">
                <div class="chat-messages p-3">
                    <template x-if="openingLineLoading">
                        <div class="message received">
                            <div class="d-flex align-items-start">
                                <div class="w-100">
                                    <div class="message-content d-flex flex-column align-items-center">
                                        <div class="received-typing-dots py-2 px-2">
                                            <i class="fas fa-circle"></i>
                                            <i class="fas fa-circle"></i>
                                            <i class="fas fa-circle"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template x-for="(message, index) in messages" :key="index">
                        <div>
<!--                            <template x-if="index % 2 === 0">-->
                            <template x-if="message.value.senderRole  === 'AI'">
                                <div class="message-body d-flex flex-column align-items-start" style="float: left;">
                                    <div class="message received">
                                        <div class="d-flex align-items-start">
                                            <div class="w-100">
                                                <div class="message-content d-flex flex-column align-items-center" :id="'message-' + index" :class="{ 'blurred': message.value.isBlurred }">
                                                    <span x-text="message.value.parsedText"></span>
                                                </div>
                                                <div class="message-translation mt-2" style="font-size: 0.8rem;" x-show="message.value.showTranslation" x-text="message.value.translation">哈囉！你好嗎？</div>
                                            </div>
                                            <i @click.stop="playMsgSound(index)" class="fas fa-rss ms-3" style="font-size: 0.8rem; margin-top: 0.4rem"></i>
                                        </div>
                                        <hr>
                                        <div class="d-flex align-items-center">
                                            <div class="rounded-circle icon-button me-3" @click="toggleBlur(index)">
                                                <i style="font-size: 0.8rem" class="fas fa-braille text-white" ></i>
                                            </div>
                                            <div class="rounded-circle icon-button me-3" @click="toggleTranslation(index)">
                                                <i style="font-size: 0.8rem" class="fas fa-language text-white"></i>
                                            </div>
                                            <div class="rounded-circle icon-button me-3" @click.stop="copy(index)">
                                                <i style="font-size: 0.8rem" class="fas fa-clone text-white"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

<!--                            <template x-if="index % 2 !== 0">-->
                            <template x-if="message.value.senderRole  === 'HUMAN'">
                                <div class="message-body d-flex flex-column align-items-end" style="float: right; margin-bottom: 20px">
                                    <div class="message sent">
                                        <div class="d-flex align-items-center">
                                            <template x-if="message.value.audioName != null">
                                                <i @click.stop="playMsgSound(index)" class="fas fa-rss me-3 text-primary" style="font-size: 0.8rem; margin-top: 0.4rem; line-height: 1; align-self: start;"></i>
                                                <span x-text="message.value.parsedText"></span>
                                            </template>
                                        </div>

                                        <div class="d-flex flex-column align-items-start">
                                            <template x-if="message.value.imageName != null">
                                                <img :src="message.value.imagePath" alt="Image" class="message-image mb-2"
                                                     style="align-self: center; max-width: 100px; max-height: 100px; border-radius: 15px">
                                            </template>
                                            <template x-if="message.value.text != null && message.value.text !== ''">
                                                <span x-text="message.value.text"></span>
                                            </template>
                                        </div>

                                        <hr>
                                        <div class="d-flex align-items-center">
                                            <div x-show="!closed && ['FREE_TALK'].includes(chatroomType)" class="rounded-circle icon-button me-3">
                                                <i
                                                        style="font-size: 0.8rem"
                                                        class="fas fa-eraser"
                                                        :class="{
                                                              'text-primary': editActiveIndex !== index,
                                                              'text-danger': editActiveIndex === index,
                                                              active: editActiveIndex === index,
                                                        }"
                                                        @click.stop="edit(index, $event)"
                                                ></i>
                                            </div>
                                            <template x-if="!closed && ['PROJECT', 'SITUATION'].includes(chatroomType) && (index >= messages.length - 2)">
                                                <div class="rounded-circle icon-button me-3">
                                                    <i
                                                            style="font-size: 0.8rem"
                                                            class="fas fa-trash-alt text-primary"
                                                            @click.stop="openDeleteModal(index)"
                                                    ></i>
                                                </div>
                                            </template>
                                            <template x-if="['PROJECT', 'SITUATION'].includes(chatroomType)">
                                                <div class="rounded-circle icon-button advanced-check" @click="advancedCheck(index)">
                                                    <i style="font-size: 0.8rem" class="fas fa-spell-check text-primary"></i>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                    <template x-if="message.key > 1">
                                        <div class="message-controls d-flex justify-content-center align-items-center mt-1">
                                            <i class="fas fa-caret-left arrow me-1"
                                               :class="{'opacity-50 pe-none': message.value.version === 1}"
                                               @click="message.value.version === 1 ? null : prevBranch(index)"></i>
                                            <span class="page-indicator" x-text="message.value.version + ' / ' + message.key" style="font-size: 0.8rem"></span>
                                            <i class="fas fa-caret-right arrow mx-1"
                                               :class="{'opacity-50 pe-none': message.key === message.value.version}"
                                               @click="message.key === message.value.version ? null : nextBranch(index)"></i>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>

                    </template>
                    <template x-if="receivedMsgLoading">
                        <div class="message received">
                            <div class="d-flex align-items-start">
                                <div class="w-100">
                                    <div class="message-content d-flex flex-column align-items-center">
                                        <div class="received-typing-dots py-2 px-2">
                                            <i class="fas fa-circle"></i>
                                            <i class="fas fa-circle"></i>
                                            <i class="fas fa-circle"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template x-if="sentMsgLoading">
                        <div class="message sent">
                            <div class="d-flex align-items-start">
                                <div class="w-100">
                                    <div class="message-content d-flex flex-column align-items-center">
                                        <div class="sent-typing-dots py-2 px-2">
                                            <i class="fas fa-circle"></i>
                                            <i class="fas fa-circle"></i>
                                            <i class="fas fa-circle"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="!closed" class="message-footer">
                <template x-if="!isTipActive">
                    <div id="tagBar" class="tag-bar">
                        <div class="tags-wrapper">
                            <template x-if="chatroomType == 'PROJECT'">
                                <span class="badge tag text-dark py-2 sample-lesson" @click.stop="getDemoSentence">
                                    <i class="fas fa-file-alt me-1" style="color: orange;"></i>
                                    範例
                                </span>
                            </template>
                            <span class="badge tag text-dark py-2" @click.stop="showTranslationModal">
                            <i class="fas fa-language me-1 text-info"></i>
                            翻譯
                        </span>
                            <template x-if="chatroomType == 'FREE_TALK'">
                                <span class="badge tag text-dark py-2" @click.stop="uploadImg()">
                                    <i class="fas fa-images me-1" style="color: var(--bs-teal);"></i>
                                    照片
                                </span>
                            </template>
<!--                            <span class="badge tag text-dark py-2">-->
<!--                            <i class="fas fa-hashtag" style="color: var(&#45;&#45;bs-purple);"></i>-->
<!--                            聊點什麼...-->
<!--                        </span>-->
<!--                            <span class="badge tag text-dark py-2" @click.stop="genNewTopic">-->
<!--                            <i class="fas fa-redo-alt" style="color: var(&#45;&#45;bs-pink);"></i>-->
<!--                            話題-->
<!--                        </span>-->
                        <input type="file" id="imageInput" multiple accept="image/*" hidden="hidden"/>
                        </div>
                    </div>
                </template>
                <div class="chat-input" id="keyboardInput">
                    <template x-if="isTipActive">
                        <div class="flex-column align-items-center d-flex justify-content-between w-100 px-3">
                            <span class="small" style="color: var(--bs-purple);">試著說</span>
                            <div class="sentence w-100 mt-2 mb-4" style="color: black; background-color: rgba(173, 216, 230, 0.1);">
                                <div class="d-flex align-items-start">
                                    <div class="w-100 mb-2">
                                        <div class="message-content tip-content">
                                            <div class="loading-spinner" style="display: none"></div>
                                            <div class="small gen-audio-content" style="line-height: 1.2;" x-text="tipContent"></div>
                                        </div>
                                        <div class="message-translation mt-2" style="font-size: 0.8rem; line-height: 1.2;" x-show="showTipTranslation" x-text="tipTranslation"></div>
                                    </div>
                                    <i @click.stop="genAudioForTip()" class="fas fa-rss ms-3 text-primary" style="font-size: 0.8rem; margin-top: 0.4rem"></i>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle icon-button me-3" @click="showTipTranslation = !showTipTranslation">
                                        <i style="font-size: 0.8rem" class="fas fa-language text-black"></i>
                                    </div>
                                    <div class="rounded-circle icon-button me-3" @click="renewTip()">
                                        <i style="font-size: 0.8rem" class="fas fa-redo-alt text-black"></i>
                                    </div>
                                    <div class="rounded-circle icon-button me-3" @click="sendTip()">
                                        <i style="font-size: 0.8rem" class="fas fa-paper-plane text-black"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="align-items-center d-flex justify-content-between w-100 px-3">
                                <template x-if="isRecording">
                                    <button
                                            @click.stop="cancelRecord()"
                                            class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                                            style="width: 45px; height: 45px;">
                                        <i style="font-weight: 100;" class="far fa-stop-circle fs-5 text-black">
                                        </i>
                                    </button>
                                </template>
                                <button @click.stop="isRecording? stopRecord() : startRecord()" :class="{ 'recording': isRecording }" class="btn rounded-circle bg-primary text-white p-0 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; border: none;">
                                    <i :class="isRecording ? 'fas fa-paper-plane' : 'fas fa-microphone-alt'" class="fs-2"></i>
                                </button>
                                <button @click="cancelTip" class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                                    <i class="far fa-times-circle text-black fs-5" style="font-weight: 100;"></i>
                                </button>
                            </div>
                        </div>
                    </template>
                    <template x-if="!isTipActive">
                        <div class="input-group align-items-center d-flex justify-content-between px-3">
                            <button
                                    @click.stop="isRecording ? cancelRecord() : showKeyboard()"
                                    class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                                    style="width: 45px; height: 45px;">
                                <i :class="isRecording ? 'far fa-stop-circle' : 'fas fa-keyboard'"
                                   style="font-weight: 100;"
                                   class="fs-5 text-black">
                                </i>
                            </button>
                            <button @click.stop="isRecording? stopRecord() : startRecord()" :class="{ 'recording': isRecording }" class="btn rounded-circle bg-primary record-btn text-white p-0 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; border: none;">
                                <i :class="isRecording ? 'fas fa-paper-plane' : 'fas fa-microphone-alt'" class="fs-2"></i>
                            </button>
                            <button @click="genTip()" :class="!showTipBtn ? 'invisible' : ''" class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                                <i class="fas fa-lightbulb text-warning fs-5" style="font-weight: 100;"></i>
                            </button>
                        </div>
                    </template>
                </div>
                <div class="chat-input d-flex flex-column d-none" id="textInput">
                    <div class="input-group image-display mb-2 d-none">
                        <div class="position-relative d-inline-block me-2 image-wrapper">
                            <img src="" class="img-thumbnail uploaded-img" style="max-width: 100px; max-height: 100px;">
                            <button @click.stop="removeImg" class="btn btn-sm btn-secondary position-absolute top-0 end-0 rounded-circle d-flex align-items-center justify-content-center p-0 opacity-50" style="width: 20px; height: 20px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="input-group d-flex align-items-center">
                        <textarea id="text" class="form-control me-2"></textarea>
                        <button class="btn btn-primary send-btn" style="border-radius: 50%" @click.stop="sendTextMsg">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="advanced-check-modal" id="advancedCheckModal">
        <div class="d-flex align-items-center justify-content-center loading-spinner-area" style="display: none">
            <div class="advanced-check-loading-spinner mt-5 mb-5" style="display: none"></div>
        </div>
        <div class="advanced-check-area">
            <div class="nav-wrapper position-relative end-0">
                <ul class="nav nav-pills nav-fill p-1" role="tablist" style="width: 50%; margin: 0 auto; border-radius: 50%">
                    <li class="nav-item">
                        <a class="nav-link mb-0 px-0 py-1 active pill-link" data-bs-toggle="tab" href="#grammar-tabs-simple" role="tab" aria-controls="grammar" aria-selected="true">
                            文法
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link mb-0 px-0 py-1 pill-link" data-bs-toggle="tab" href="#sentence-tabs-simple" role="tab" aria-controls="sentence" aria-selected="false">
                            精進
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link mb-0 px-0 py-1 pill-link" data-bs-toggle="tab" href="#pronunciation-tabs-simple" role="tab" aria-controls="pronunciation" aria-selected="false">
                            發音
                        </a>
                    </li>
                </ul>
            </div>
            <hr>

            <div class="tab-content mt-3 grammar-tab-content">
                <div class="tab-pane fade show active" id="grammar-tabs-simple" role="tabpanel" aria-labelledby="grammar-tab">
                    <template x-if="!grammarAccuracy">
                        <div>
                            <!-- 文法 Tab 的內容 -->
                            <div class="grammar w-100" style="color: black; background-color: rgba(255, 192, 203, 0.1);">
                                <i class="fas fa-times-circle me-2 small text-danger"></i>
                                <span x-text="errorSentence" style="font-size: 0.9rem"></span>
                            </div>
                            <div class="grammar w-100" style="color: black; background-color: rgba(144, 238, 144, 0.1);">
                                <i class="fas fa-check-circle me-2 small" style="color: var(--bs-teal);"></i>
                                <span x-text="correctSentence" style="font-size: 0.9rem"></span>
                                <hr class="mt-2 mb-2" style="color: var(--bs-teal);">
                                <div class="d-inline-flex align-items-center flex-nowrap w-100">
                                    <i @click="toggleFavorite(correctUnitNumber, correctSentence, '')"
                                       x-bind:class="{'far fa-bookmark': !correctFavorite, 'fas fa-bookmark': correctFavorite}"
                                       class="far fa-bookmark small me-3"
                                       style="cursor: pointer; color: #0d6efd; font-size: 0.8rem;"></i>
                                    <i :data-url="grammarAudioPath" @click.stop="playAdvancedSound($event.target, 1)" class="fas fa-rss text-primary" style="font-size: 0.8rem;"></i>
                                    <div @click.stop="shadowing('grammar')" class="audio-practice bg-white border-0 rounded-pill ms-auto d-inline-flex align-items-center">
                                        <i class="fab fa-rocketchat text-primary ms-2" style="font-size: 0.8rem;"></i>
                                        <span class="ms-1 text-primary mt-1 mb-1 me-2" style="font-size: 0.8rem;">練習</span>
                                    </div>
                                </div>
                            </div>
                            <div class="grammar-text w-100 d-flex flex-column" style="color: black;">
                                <span class="fw-bold small">錯誤原因</span>
                                <span x-text="errorReason" style="font-size: 0.8rem;"></span>
                                <span class="fw-bold small mt-2">翻譯</span>
                                <span x-text="grammarReasonTranslation" style="font-size: 0.8rem;"></span>
                            </div>
                        </div>
                    </template>
                    <template x-if="grammarAccuracy">
                        <div class="d-flex flex-column align-items-center justify-content-center">
                            <i class="fas fa-check fs-1 fw-bold" style="color: var(--bs-teal);"></i>
                            <span class="fs-2 mt-2 fw-bold" style="color: var(--bs-teal);">做得好！</span>
                        </div>
                    </template>
                </div>

                <div class="tab-pane fade" id="sentence-tabs-simple" role="tabpanel" aria-labelledby="sentence-tab">
                    <!-- 精進 Tab 的內容 -->
                    <span class="text-center" style="color: var(--bs-purple);">非正式</span>
                    <div class="sentence w-100 mt-2" style="color: black; background-color: rgba(173, 216, 230, 0.1);">
                        <div class="d-flex align-items-start">
                            <div class="w-100">
                                <div class="message-content">
                                    <div class="d-flex flex-column">
                                        <span class="mb-1" x-text="informalContent" style="font-size: 0.9rem"></span>
                                        <span x-show="showInformalTranslation" class="text-secondary" x-text="informalTranslation" style="font-size: 0.7rem"></span>
                                    </div>
                                    <hr class="mt-2 mb-2" style="color: var(--bs-cyan);">
                                    <div class="d-inline-flex align-items-center flex-nowrap w-100">
                                        <i @click="toggleFavorite(informalUnitNumber, informalContent, '')"
                                           x-bind:class="{'far fa-bookmark': !informalFavorite, 'fas fa-bookmark': informalFavorite}"
                                           class="far fa-bookmark small me-3"
                                           style="cursor: pointer; color: #0d6efd;"></i>
                                        <i @click.stop="toggleInformalTranslation" style="font-size: 0.8rem" class="fas fa-language text-primary me-3"></i>
                                        <i :data-url="informalAudioPath" @click="playAdvancedSound($event.target, 1)" class="fas fa-rss text-primary" style="font-size: 0.8rem;"></i>
                                        <div @click.stop="shadowing('informal')" class="audio-practice bg-white border-0 rounded-pill ms-auto d-inline-flex align-items-center">
                                            <i class="fab fa-rocketchat text-primary ms-2" style="font-size: 0.8rem;"></i>
                                            <span class="ms-1 text-primary mt-1 mb-1 me-2" style="font-size: 0.8rem;">練習</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sentence-text w-100 d-flex flex-column mb-3" style="color: black;">
                        <span class="fw-bold small">解釋</span>
                        <span x-text="informalExplanation" class="small"></span>
                    </div>
                    <hr>

                    <span class="text-center" style="color: var(--bs-purple);">正式</span>
                    <div class="sentence w-100 mt-2" style="color: black; background-color: rgba(173, 216, 230, 0.1);">
                        <div class="d-flex align-items-start">
                            <div class="w-100">
                                <div class="message-content">
                                    <div class="d-flex flex-column">
                                        <span class="mb-1" x-text="formalContent" style="font-size: 0.9rem"></span>
                                        <span x-show="showFormalTranslation" class="text-secondary" x-text="formalTranslation" style="font-size: 0.7rem"></span>
                                    </div>
                                    <hr class="mt-2 mb-2" style="color: var(--bs-cyan);">
                                    <div class="d-inline-flex align-items-center flex-nowrap w-100">
                                        <i @click="toggleFavorite(formalUnitNumber, formalContent, '')"
                                           x-bind:class="{'far fa-bookmark': !formalFavorite, 'fas fa-bookmark': formalFavorite}"
                                           class="far fa-bookmark small me-3"
                                           style="cursor: pointer; color: #0d6efd;"></i>
                                        <i @click.stop="toggleFormalTranslation" style="font-size: 0.8rem" class="fas fa-language text-primary me-3"></i>
                                        <i :data-url="formalAudioPath" @click="playAdvancedSound($event.target, 1)" class="fas fa-rss text-primary" style="font-size: 0.8rem;"></i>
                                        <div @click.stop="shadowing('formal')" class="audio-practice bg-white border-0 rounded-pill ms-auto d-inline-flex align-items-center">
                                            <i class="fab fa-rocketchat text-primary ms-2" style="font-size: 0.8rem;"></i>
                                            <span class="ms-1 text-primary mt-1 mb-1 me-2" style="font-size: 0.8rem;">練習</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sentence-text w-100 d-flex flex-column" style="color: black;">
                        <span class="fw-bold small">解釋</span>
                        <span x-text="formalExplanation" class="small"></span>
                    </div>

                </div>
                <div class="tab-pane fade" id="pronunciation-tabs-simple" role="tabpanel" aria-labelledby="pronunciation-tab">
                    <!-- 發音 Tab 的內容 -->
                    <template x-if="grammarOverallScore > 0">
                        <div>
                            <div class="sentence w-100" style="color: black; background-color: rgba(173, 216, 230, 0.1);">
                                <div class="d-flex align-items-start">
                                    <div class="w-100">
                                        <div class="message-content d-flex align-items-center justify-content-between w-100">
                                            <div class="d-flex align-items-center">
                                                <img src="img/favicon.png" class="me-2" style="width: 40px; height: 40px;" alt="">
                                                <template x-if="grammarOverallScore >= 80">
                                                    <span class="fs-5 fw-bold" style="color: var(--bs-teal);">做得好！</span>
                                                </template>
                                                <template x-if="grammarOverallScore < 80 && grammarOverallScore >= 60">
                                                    <span class="fs-5 mt-2 fw-bold text-warning">不錯喔！</span>
                                                </template>
                                                <template x-if="grammarOverallScore < 60">
                                                    <span class="fs-5 mt-2 fw-bold text-danger">繼續加油！</span>
                                                </template>
                                            </div>

                                            <div>
                                                <template x-if="grammarOverallScore >= 80">
                                                    <span class="fw-bold" style="color: var(--bs-teal);" x-text="grammarOverallScore"></span>
                                                </template>
                                                <template x-if="grammarOverallScore < 80 && grammarOverallScore >= 60">
                                                    <span class="fw-bold text-warning" x-text="grammarOverallScore"></span>
                                                </template>
                                                <template x-if="grammarOverallScore < 60">
                                                    <span class="fw-bold text-danger" x-text="grammarOverallScore"></span>
                                                </template>
                                                <span class="small" x-bind:class="{'text-warning': grammarOverallScore < 80 && grammarOverallScore >= 60, 'text-danger': grammarOverallScore < 60, 'text-success': grammarOverallScore >= 80}">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="sentence w-100 mt-2" style="color: black; background-color: rgba(173, 216, 230, 0.1);">
                            <div class="d-flex align-items-start">
                                <div class="w-100">
                                    <div class="message-content">
                                        <span x-html="pronunciationText"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-start mt-2">
                            <div @click="pronunciationAudio" style="background-color: rgba(173, 216, 230, 0.3);" class="rounded-pill border-0 pe-2 ps-1 pt-1 pb-1 d-flex align-items-center me-3">
                                <img x-bind:src="partner.coverPath" class="avatar small me-2" alt="partner img">
                                <i class="fas fa-rss text-primary me-2" style="font-size: 0.8rem;"></i>
                            </div>
                            <div @click="myVoice" style="background-color: rgba(173, 216, 230, 0.3);" class="rounded-pill border-0 pe-2 ps-1 pt-1 pb-1 d-flex align-items-center">
                                <div class="rounded-circle d-flex justify-content-center align-items-center me-2"
                                     style="width: 35px; height: 35px; background-color: white; font-weight: bold; color: black;">
                                    Me
                                </div>
                                <i class="fas fa-rss text-primary me-2" style="font-size: 0.8rem;"></i>
                            </div>
                        </div>
                    </template>
                    <template x-if="grammarOverallScore < 0">
                        <div class="sentence w-100" style="color: black; background-color: rgba(173, 216, 230, 0.1);">
                            <div class="d-flex align-items-start">
                                <div class="w-100">
                                    <div class="d-flex flex-column align-items-center justify-content-center">
                                        <i class="far fa-hand-paper fs-1 fw-bold text-warning"></i>
                                        <span class="fs-2 mt-2 fw-bold text-warning">無發音分析</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

    </div>

    <div class="sample-lesson-modal" id="sampleLessonModal">
        <div class="nav-wrapper position-relative end-0">
            <ul class="nav nav-pills nav-fill p-1" role="tablist" style="width: 50%; margin: 0 auto; border-radius: 50%">
                <li class="nav-item">
                    <a @click="showSentences('basic-tabs-simple')" class="nav-link mb-0 px-0 py-1 active pill-link" data-bs-toggle="tab" href="#basic-tabs-simple" role="tab" aria-controls="basic" aria-selected="true">
                        基礎
                    </a>
                </li>
                <li class="nav-item">
                    <a @click="showSentences('advanced-tabs-simple')" class="nav-link mb-0 px-0 py-1 pill-link" data-bs-toggle="tab" href="#advanced-tabs-simple" role="tab" aria-controls="advanced" aria-selected="false">
                        進階
                    </a>
                </li>
            </ul>
        </div>
        <hr>

        <div class="tab-content">
            <div
                    class="tab-pane fade show active"
                    id="basic-tabs-simple"
                    role="tabpanel"
                    aria-labelledby="basic-tab"
            >
                <ul class="list-group px-1">
                    <template x-for="(item,index) in basicSentences" :key="index">
                        <li class="list-group-item border-0 d-flex align-items-start px-0 mb-1">
                            <div class="d-flex align-items-start flex-column justify-content-center me-4">
                                <div class="d-flex w-100">
                                    <p class="mb-1 small font-weight-bold text-dark english me-2" x-text="item.content" style="font-size: 0.9rem"></p>
                                    <i @click="toggleFavorite(item.unitNumber, item.content, item.translation)" x-bind:class="{'far fa-bookmark': !item.favorite, 'fas fa-bookmark': item.favorite}"
                                       class="small" style="cursor: pointer; color: #0d6efd; margin-top: 0.3rem;"></i>
                                </div>
                                <p class="mb-0 small translate text-secondary" x-text="item.translation" style="font-size: 0.7rem"></p>
                            </div>
                            <i
                                    class="mt-1 fas fa-rss text-primary small ms-auto"
                                    @click="playSound(item.lessonNumber, item.audioName[0])"
                                    style="cursor: pointer;"
                            ></i>
                        </li>
                    </template>
                </ul>
            </div>

            <div
                    class="tab-pane fade"
                    id="advanced-tabs-simple"
                    role="tabpanel"
                    aria-labelledby="advanced-tab"
            >
                <ul class="list-group px-1">
                    <template x-for="(item,index) in advancedSentences" :key="index">
                        <li class="list-group-item border-0 d-flex align-items-start px-0 mb-1">
                            <div class="d-flex align-items-start flex-column justify-content-center me-2">
                                <div class="d-flex w-100">
                                    <p class="mb-1 font-weight-bold text-dark english me-2" x-text="item.content" style="font-size: 0.9rem"></p>
                                    <i @click="toggleFavorite(item.unitNumber, item.content, item.translation)" x-bind:class="{'far fa-bookmark': !item.favorite, 'fas fa-bookmark': item.favorite}"
                                       class="small" style="cursor: pointer; color: #0d6efd; margin-top: 0.3rem;"></i>
                                </div>
                                <p class="mb-0 small translate text-secondary" x-text="item.translation" style="font-size: 0.7rem"></p>
                            </div>
                            <i
                                    class="mt-1 fas fa-rss text-primary small ms-auto"
                                    @click="playSound(item.lessonNumber, item.audioName[0])"
                                    style="cursor: pointer;"
                            ></i>
                        </li>
                    </template>
                </ul>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-2 w-100">
                <template x-if="isRecording">
                    <button
                            @click.stop="cancelRecord()"
                            class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                            style="width: 45px; height: 45px;">
                        <i class="far fa-stop-circle fs-5 text-black" style="font-weight: 100;"></i>
                    </button>
                </template>
                <button @click.stop="isRecording? stopRecord() : startRecord()" :class="{ 'recording': isRecording }" class="btn rounded-circle bg-primary text-white p-0 mx-auto" style="width: 60px; height: 60px; border: none;">
                    <i :class="isRecording ? 'fas fa-paper-plane' : 'fas fa-microphone-alt'" class="fs-2"></i>
                </button>
<!--                無用-->
                <template x-if="isRecording">
                    <button
                            class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                            style="width: 45px; height: 45px; visibility: hidden;">
                        <i class="far fa-times-circle fs-5 text-black" style="font-weight: 100;"></i>
                    </button>
                </template>
<!--            無用-->
            </div>

        </div>

    </div>


    <div class="translation-modal " id="translationModal">
        <div class="position-relative d-flex justify-content-center align-items-center py-2">
            <span class="text-center small" style="color: var(--bs-purple);">翻譯</span>
            <button @click.stop="translation" class="small px-3 py-1 translation-button position-absolute end-0">翻譯</button>
        </div>
        <hr>
        <div class="translation-div px-4">
            <textarea class="small translation-input" placeholder=" " id="inputField"></textarea>
            <label for="inputField" class="translation-label">輸入您的母語</label>
        </div>
        <div class="translation-div px-4 pb-4 mt-2 position-relative d-none" id="translation-response-div">
            <span class="small text-break me-3 translate-response"></span>
            <i @click.stop="genAudioForTranslation()" class="fas fa-rss text-primary position-absolute top-0 end-0 px-3" style="font-size: 0.8rem; margin-top: 1.5rem"></i>
        </div>
        <div class="d-flex align-items-center justify-content-between w-100 mt-4">
            <template x-if="isRecording">
                <button
                        @click.stop="cancelRecord()"
                        class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                        style="width: 45px; height: 45px;">
                    <i class="far fa-stop-circle fs-5 text-black" style="font-weight: 100;"></i>
                </button>
            </template>
            <button @click.stop="isRecording? stopRecord() : startRecord()" :class="{ 'recording': isRecording }" class="btn rounded-circle bg-primary text-white p-0 mx-auto" style="width: 60px; height: 60px; border: none;">
                <i :class="isRecording ? 'fas fa-paper-plane' : 'fas fa-microphone-alt'" class="fs-2"></i>
            </button>
<!--            無用-->
            <template x-if="isRecording">
                <button
                        class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                        style="width: 45px; height: 45px; visibility: hidden;">
                    <i class="far fa-times-circle fs-5 text-black" style="font-weight: 100;"></i>
                </button>
            </template>
<!--            無用-->
        </div>

    </div>

</div>

<div class="overlay" id="overlay"></div> <!-- 遮罩 -->

<div class="notification d-none">
    <p id="copiedText">Copied</p>
</div>

<div class="partner-block-area d-none">
    <p class="block-text">
        <span x-text="partner.displayName"></span> 在說話
    </p>
</div>

<div class="human-block-area d-none">
    <p class="block-text">
        <span>你在說話</span>
    </p>
</div>

<div id="waiting-screen">
    <div class="waiting-content">
        <img id="waiting-image" src="img/peanut.png" alt="Loading">
        <p id="waiting-text">您順利完成了這堂課，獲得 <span class="text-danger font-weight-bold">5 EXP</span>！</p>
        <p><span class="text-primary font-weight-bold">正在製作你的學習報告，請稍候...</span></p>
    </div>
</div>

<div id="chatroom-history">
    <div class="chatroom-history-header py-3 d-flex align-items-center justify-content-between">
        <button @click.stop="hideTalkRecord" class="text-dark ps-3" style="border: 0; background-color: white" data-bs-dismiss="modal">
            <span aria-hidden="true">
                <i class="fas fa-chevron-left"></i>
            </span>
        </button>
        <span>歷史紀錄</span>
        <span aria-hidden="true">
            <i class="fas fa-chevron-left invisible ps-3"></i>
        </span>
    </div>
    <div class="chatroom-history-body">
        <template x-for="(item, index) in chatroomIdTitles" :key="index">
            <div @click.stop="enterChatroom(item.key)" :class="{'custom-mb-9': dropdownRecordOpen === index, 'mb-2': dropdownRecordOpen !== index}" class="history-btn mb-2 py-2 px-4">
                <span x-show="showEditRecordTitle !== index" x-text="item.value" class="small"></span>
                <div x-show="showEditRecordTitle === index">
                    <div class="d-flex align-items-center">
                        <input x-model="item.value" class="form-control me-2" type="text" @click.stop/>
                        <button class="btn btn-primary rounded-circle" @click.stop="editTitle(item)">
                            <i class="fas fa-pen-alt text-white"></i>
                        </button>
                    </div>
                </div>
                <div x-show="showEditRecordTitle !== index" class="dropdown dropdown-history-record">
                    <button @click.stop="toggleRecordDropdown(index, $event, item.key, item.value)"
                            class="btn btn-link text-dark ps-3 dropdown-record-icon"
                            id="dropdownRecordBtn"
                            data-bs-toggle="dropdown-record"
                    >
                        <i class="fas fa-ellipsis-v text-secondary ms-3 small"></i>
                    </button>
                    <ul x-bind:style="dropdownRecordStyle" class="dropdown-menu dropdown-menu-end dropdown-record" :class="{'show': dropdownRecordOpen === index}">
                        <li class="list-group-item border-0 px-0" data-bs-toggle="modal" data-bs-target="#shareModal" @click.stop="openSharingModal(item.key)">
                            <div class="form-check form-switch ps-0 d-flex align-items-center">
                                <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small">
                                    <i class="fas fa-share-square me-2"></i>
                                    <span>分享</span>
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item border-0 px-0"
                            @click.stop="showEditRecordTitle = (showEditRecordTitle === index ? null : index); dropdownRecordOpen = null"
                        >
                            <div class="form-check form-switch ps-0 d-flex align-items-center">
                                <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small">
                                    <i class="fas fa-pen-alt me-2"></i>
                                    <span>重新命名</span>
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item border-0 px-0" data-bs-toggle="modal" data-bs-target="#deleteRecordModal" @click.stop>
                            <div class="form-check form-switch ps-0 d-flex align-items-center">
                                <label class="form-check-label text-body ms-3 mx-5 py-2 text-truncate w-80 mb-0 small">
                                    <i class="fas fa-trash-alt text-danger me-2"></i>
                                    <span class="text-danger">刪除</span>
                                </label>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </template>
    </div>

</div>

<!--deleteRecordModal-->
<div class="modal fade" id="deleteRecordModal" tabindex="-1" role="dialog" aria-labelledby="deleteRecordModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteRecordModalLabel">刪除對話？</h5>
                <span data-bs-dismiss="modal" aria-hidden="true" class="text-secondary">×</span>
            </div>
            <div class="modal-body d-flex flex-column">
                <span class="text-start w-100">即將刪除 <span class="fw-bold" x-text="dropdownRecordName"></span></span>
                <div class="d-flex justify-content-end w-100 mt-4">
                    <button type="button" data-bs-dismiss="modal" class="btn btn-outline-dark rounded-pill px-3 btn-sm">取消</button>
                    <button type="button" @click.stop="deleteChatRecord()" class="btn btn-danger text-white rounded-pill px-3 ms-2 btn-sm">刪除</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--shareModal-->
<div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModal" aria-hidden="true" @click.stop>
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <template x-if="targetSnapshotId == null && snapshotLink == ''">
                    <h5 class="modal-title">分享對話的公開連結</h5>
                </template>
                <template x-if="targetSnapshotId !== null && snapshotLink == ''">
                    <h5 class="modal-title">更新對話的公開連結</h5>
                </template>
                <template x-if="targetSnapshotId !== null && snapshotLink !== ''">
                    <h5 class="modal-title">已建立公開連結</h5>
                </template>
                <span data-bs-dismiss="modal" aria-hidden="true" class="text-secondary">×</span>
            </div>
            <div class="modal-body d-flex flex-column align-items-start">
                <span class="text-start w-100">你的名稱以及分享後新增的任何對話都將保密。</span>
                <div class="d-flex justify-content-between align-items-center border rounded-pill p-2 mt-4">
                    <div class="flex-grow-1">
                        <input x-model="snapshotLink" class="form-control border-0 shadow-none" readonly placeholder="https://gurula.cc/talkyo/share/...">
                    </div>
                    <template x-if="targetSnapshotId == null && snapshotLink == ''">
                        <button @click.stop="createLink()" class="btn btn-dark rounded-pill d-flex align-items-center" style="white-space: nowrap;">
                            <i class="fas fa-paperclip me-2 text-white"></i>
                            <span>建立連結</span>
                        </button>
                    </template>
                    <template x-if="targetSnapshotId !== null && snapshotLink == ''">
                        <button @click.stop="updateLink" class="btn btn-dark rounded-pill d-flex align-items-center" style="white-space: nowrap;">
                            <i class="fas fa-paperclip me-2 text-white"></i>
                            <span>更新連結</span>
                        </button>
                    </template>
                    <template x-if="snapshotLink !== ''">
                        <button @click.stop="copyLink(snapshotLink)" class="btn btn-dark rounded-pill d-flex align-items-center" style="white-space: nowrap;">
                            <i class="fas fa-copy me-2 text-white"></i>
                            <span>複製</span>
                        </button>
                    </template>
                </div>
                <div class="w-100 mt-1" x-show="targetSnapshotId !== null">
                    <span class="text-secondary" style="font-size: 0.8rem">已分享此對話的過往版本。請透過</span>
                    <span @click.stop="openSettingModal" data-bs-toggle="modal" data-bs-target="#settingModal" class="text-secondary text-decoration-underline" style="font-size: 0.8rem">「設定」</span>
                    <span class="text-secondary" style="font-size: 0.8rem">管理之前已分享的對話。</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!--settingModal-->
<div class="modal fade" id="settingModal" tabindex="-1" role="dialog" aria-labelledby="deleteRecordModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">共享的連結</h5>
                <span data-bs-dismiss="modal" aria-hidden="true" class="text-secondary">×</span>
            </div>
            <div class="modal-body d-flex flex-column">
                <ul class="list-group">
                    <template x-for="(item,index) in snapshotList" :key="index">
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div class="d-flex flex-column">
                                <div class="d-flex align-items-center" @click.stop="showLink(item.link)">
                                    <i style="font-size: 0.9rem;" class="fas fa-paperclip text-primary font-weight-bold mb-1 me-2"></i>
                                    <h6 class="mb-1 text-primary font-weight-bold" x-text="item.title"></h6>
                                </div>
                                <span style="font-size: 0.8rem;" class="text-secondary" x-text="item.sharingDateTime"></span>
                            </div>
                            <div class="d-flex align-items-center" @click.stop="deleteLink(item.id)">
                                <i class="fas fa-trash-alt text-danger"></i>
                            </div>
                        </li>
                    </template>
                </ul>
            </div>
        </div>
    </div>
</div>

<!--errorModal-->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Oops! 連結已失效...</h5>
            </div>
            <div class="modal-body d-flex align-items-center justify-content-center">
                <a href="index.html" type="button" class="btn btn-outline-dark rounded-pill px-3 btn-sm">回首頁</a>
            </div>
        </div>
    </div>
</div>

<!--deleteMessageModal-->
<div class="modal fade" id="deleteMessageModal" tabindex="-1" role="dialog" aria-labelledby="deleteMessageModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-times-circle me-2 text-danger"></i>刪除該則對話？</h5>
                <span data-bs-dismiss="modal" aria-hidden="true" class="text-secondary">×</span>
            </div>
            <div class="modal-body d-flex justify-content-center w-100">
                <button type="button" data-bs-dismiss="modal" class="btn btn-outline-dark rounded-pill px-3 btn-sm">取消</button>
                <button type="button" @click.stop="deleteMessage" class="btn btn-danger text-white rounded-pill px-3 ms-2 btn-sm">刪除</button>
            </div>
        </div>
    </div>
</div>

<!--shadowingModal-->
<div class="modal fade" id="shadowingModal" tabindex="-1" role="dialog" aria-labelledby="shadowingModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content" style="background: linear-gradient(to bottom, #007bff, #6f42c1);">
            <div class="modal-header">
                <h6 class="modal-title text-white"><i class="fab fa-rocketchat text-secondary me-2 text-white"></i>跟讀練習</h6>
                <span data-bs-dismiss="modal" aria-hidden="true" class="text-white">×</span>
            </div>
            <div class="modal-body d-flex flex-column justify-content-center w-100 mt-4 mb-4" style="padding-top: 20px">
                <div class="pt-2 pb-2 d-flex justify-content-center align-items-center w-100" style="background-color: #cfe2ff; border-radius: 15px 15px 0px 0px;">
                    <img x-bind:src="partner.coverPath" class="avatar small me-2" alt="partner img">
                    <span class="text-primary text-center">跟著我重複一遍</span>
                </div>
                <div class="d-flex flex-column justify-content-center w-100 pt-4 pe-4 ps-4" style="background-color: #f8f9fa; border-radius: 0px 0px 15px 15px; padding-bottom: 20px">
                    <template x-if="switchGrammar">
                        <span x-text="correctSentence" class="mb-2 fs-5 text-center"></span>
                    </template>
                    <template x-if="switchGrammar">
                        <span x-text="grammarReasonTranslation" style="font-size: 0.6rem" class="mb-5 text-secondary text-center"></span>
                    </template>
                    <template x-if="switchInformal">
                        <span x-text="informalContent" class="mb-2 fs-5 text-center"></span>
                    </template>
                    <template x-if="switchInformal">
                        <span x-text="informalTranslation" style="font-size: 0.6rem" class="mb-5 text-secondary text-center"></span>
                    </template>
                    <template x-if="switchFormal">
                        <span x-text="formalContent" class="mb-2 fs-5 text-center"></span>
                    </template>
                    <template x-if="switchFormal">
                        <span x-text="informalTranslation" style="font-size: 0.6rem" class="mb-5 text-secondary text-center"></span>
                    </template>
                    <template x-if="switchInformal">
                        <div class="d-flex justify-content-between w-100 pe-5 ps-5 mb-5 pb-5">
                            <div :data-url="informalAudioPath" @click.stop="playAdvancedSound($event.target, 0.7)" style="background-color: #cfe2ff" class="rounded-circle pe-2 ps-2 pt-1 pb-1 d-flex justify-content-center align-items-center">
                                <img :data-url="informalAudioPath" src="img/turtle.png" width="20" height="20">
                            </div>
                            <div :data-url="informalAudioPath" @click.stop="playAdvancedSound($event.target, 1)" class="rounded-circle pe-2 ps-2 pt-2 pb-2 d-flex justify-content-center align-items-center" style="background-color: #cfe2ff">
                                <i :data-url="informalAudioPath" class="fas fa-rss text-primary"></i>
                            </div>
                            <div :data-url="shadowingAudioUrl" @click.stop="playAdvancedSound($event.target, 1)" :class="{ 'disabled': !shadowingAudioUrl }" class="rounded-circle pe-2 ps-2 pt-1 pb-1 d-flex justify-content-center align-items-center" style="background-color: #cfe2ff">
                                <i :data-url="shadowingAudioUrl" class="fas fa-assistive-listening-systems text-primary"></i>
                            </div>
                        </div>
                    </template>
                    <template x-if="switchFormal">
                        <div class="d-flex justify-content-between w-100 pe-5 ps-5 mb-5 pb-5">
                            <div :data-url="formalAudioPath" @click.stop="playAdvancedSound($event.target, 0.7)" style="background-color: #cfe2ff" class="rounded-circle pe-2 ps-2 pt-1 pb-1 d-flex justify-content-center align-items-center">
                                <img :data-url="formalAudioPath" src="img/turtle.png" width="20" height="20">
                            </div>
                            <div :data-url="formalAudioPath" @click.stop="playAdvancedSound($event.target, 1)" class="rounded-circle pe-2 ps-2 pt-2 pb-2 d-flex justify-content-center align-items-center" style="background-color: #cfe2ff">
                                <i :data-url="formalAudioPath" class="fas fa-rss text-primary"></i>
                            </div>
                            <div :data-url="shadowingAudioUrl" @click.stop="playAdvancedSound($event.target, 1)" :class="{ 'disabled': !shadowingAudioUrl }" class="rounded-circle pe-2 ps-2 pt-1 pb-1 d-flex justify-content-center align-items-center" style="background-color: #cfe2ff">
                                <i :data-url="shadowingAudioUrl" class="fas fa-assistive-listening-systems text-primary"></i>
                            </div>
                        </div>
                    </template>
                    <template x-if="switchGrammar">
                        <div class="d-flex justify-content-between w-100 pe-5 ps-5 mb-5 pb-5">
                            <div :data-url="grammarAudioPath" @click.stop="playAdvancedSound($event.target, 0.7)" style="background-color: #cfe2ff" class="rounded-circle pe-2 ps-2 pt-1 pb-1 d-flex justify-content-center align-items-center">
                                <img :data-url="grammarAudioPath" src="img/turtle.png" width="20" height="20">
                            </div>
                            <div :data-url="grammarAudioPath" @click.stop="playAdvancedSound($event.target, 1)" class="rounded-circle pe-2 ps-2 pt-2 pb-2 d-flex justify-content-center align-items-center" style="background-color: #cfe2ff">
                                <i :data-url="grammarAudioPath" class="fas fa-rss text-primary"></i>
                            </div>
                            <div :data-url="shadowingAudioUrl" @click.stop="playAdvancedSound($event.target, 1)" :class="{ 'disabled': !shadowingAudioUrl }" class="rounded-circle pe-2 ps-2 pt-1 pb-1 d-flex justify-content-center align-items-center" style="background-color: #cfe2ff">
                                <i :data-url="shadowingAudioUrl" class="fas fa-assistive-listening-systems text-primary"></i>
                            </div>
                        </div>
                    </template>
                    <div class="d-flex align-items-center justify-content-between w-100 pe-3 ps-3 pt-5 mb-3">
                        <template x-if="isRecording">
                            <button
                                    @click.stop="cancelRecord()"
                                    class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                                    style="width: 45px; height: 45px;">
                                <i class="far fa-stop-circle fs-5 text-black" style="font-weight: 100;"></i>
                            </button>
                        </template>
                        <button @click.stop="isRecording? stopRecord() : startShadowing()" :class="{ 'recording': isRecording }" class="btn rounded-circle bg-primary text-white p-0 mx-auto" style="width: 60px; height: 60px; border: none;">
                            <i :class="isRecording ? 'fas fa-paper-plane' : 'fas fa-microphone-alt'" class="fs-2"></i>
                        </button>
                        <!--            無用-->
                        <template x-if="isRecording">
                            <button
                                    class="btn btn-link rounded-circle border p-0 d-flex align-items-center justify-content-center"
                                    style="width: 45px; height: 45px; visibility: hidden;">
                                <i class="far fa-times-circle fs-5 text-black" style="font-weight: 100;"></i>
                            </button>
                        </template>
                        <!--            無用-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="js/sockjs.min.js"></script>
<script src="js/stomp.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/alpine.2.8.2.min.js"></script>
<script src="js/chatroom.js"></script>
</body>
</html>